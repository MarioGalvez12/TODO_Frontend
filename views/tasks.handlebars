<div class="d-flex justify-content-center container">
  <div class="col-md-8">
    <div class="card-hover-shadow-2x mb-3 card">
      <div class="card-header-tab card-header">
        <div class="card-header-title font-size-lg text-capitalize font-weight-normal">
            <i class="fa fa-tasks"></i>&nbsp;Task Lists
        </div>
      </div>
      <div class="scroll-area-sm">
        <perfect-scrollbar class="ps-show-limits">
          <div style="position: static;" class="ps ps--active-y">
            <div class="ps-content">
              <ul class=" list-group list-group-flush">
                {{#each tasks}}
                <li class="list-group-item">
                  <div class="todo-indicator bg-primary"></div>
                  <div class="widget-content p-0">
                    <div class="widget-content-wrapper">
                      <div class="widget-content-left mr-2">
                        <div class="custom-checkbox custom-control">
                          <input class="custom-control-input" id="checkbox{{@index}}" type="checkbox">
                          <label class="custom-control-label" for="checkbox{{@index}}">&nbsp;</label>
                        </div>
                      </div>
                      <div class="widget-content-left flex2">
                        <div class="widget-heading">{{this.title}}</div>
                        <div class="widget-subheading">{{this.text}}</div>
                      </div>
                      <div class="widget-content-right">
                        <button id="priorityUp"  class="border-0 btn-transition btn btn-outline-secondary">
                          <i class="fa-solid fa-arrow-up"></i>
                        </button>
                        <button id="priorityDown"  class="border-0 btn-transition btn btn-outline-secondary">
                          <i class="fa-solid fa-arrow-down"></i>
                        </button>
                        <button class="border-0 btn-transition btn btn-outline-primary">
                          <i class="fa-solid fa-ellipsis" style="color: black;"></i>
                        </button>
                        <button id="delete{{@index}}" onclick="deleteTask('{{this._id}}')" class="border-0 btn-transition btn btn-outline-danger">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </li>
                {{/each}}
              </ul>
            </div>
          </div>
        </perfect-scrollbar>
      </div>
      <div div class="d-block text-right card-footer">
        <button class="mr-2 btn btn-link btn-sm">Cancel</button>
        <button class="btn btn-primary">Add Task</button>
      </div>
    </div>
  </div>
</div>

<script>
  function deleteTask(idTask) {
    const parseCookie = str =>
      str
      .split(';')
      .map(v => v.split('='))
      .reduce((acc, v) => {
        acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
        return acc;
      }, {});
		let requestOptions = {
			method: 'DELETE',
      headers: {
        "Authorization": parseCookie(document.cookie).Authorization
      }
		};
		let status = 0;
		fetch("{{API_URL}}" + "/api/tasks?idTask=" + idTask, requestOptions)
			.then(response => {
				status = response.status
				return response.text()
			})
			.then(result => {
				switch (status) {
					case 200:
						location.reload()
						break;
					default:
						toastr.error(JSON.parse(result).message)
						break;
				}
			})
			.catch(error => toastr.error(error));
	}
</script>